<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en-us">

  <head>
	<link href="http://gmpg.org/xfn/11" rel="profile">
		<meta http-equiv="X-UA-Compatible" content="IE=edge">
			<meta http-equiv="content-type" content="text/html; charset=utf-8">
				
				<!-- Enable responsiveness on mobile devices-->
				<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">
					
					<title>
					
				Usecases &middot; RTCGA
				
				</title>
					<script>
					(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
						(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
						m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
					})(window,document,'script','//www.google-analytics.com/analytics.js','ga');
				
				ga('create', 'UA-75667517-1', 'auto');
				ga('send', 'pageview');
				
				</script>
					
					<!-- CSS -->
					<link rel="stylesheet" href="/RTCGA/public/css/poole.css">
						<link rel="stylesheet" href="/RTCGA/public/css/syntax.css">
							<link rel="stylesheet" href="/RTCGA/public/css/lanyon.css">
								<link rel="stylesheet" href="/RTCGA/public/css/custom.css">
									<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=PT+Serif:400,400italic,700%7CPT+Sans:400">
										
										<!-- Icons -->
										<link rel="apple-touch-icon-precomposed" sizes="144x144" href="/RTCGA/public/apple-touch-icon-precomposed.png">
											<link rel="shortcut icon" href="/RTCGA/public/favicon.ico">
												
												<!-- RSS -->
												<link rel="alternate" type="application/rss+xml" title="RSS" href="/atom.xml">
													
													<!-- Mathjax -->
													<script type="text/javascript"
													src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
														</script>
														<script type="text/javascript" src="/RTCGA/public/js/mathjaxcustom.js"></script>
														
													<!--Disqus comment counts-->
														<script id="dsq-count-scr" src="//RTCGA.disqus.com/count.js" async></script>
														
													
													</head>

  <body class="layout-reverse">

    <!-- Target for toggling the sidebar `.sidebar-checkbox` is for regular
     styles, `#sidebar-checkbox` for behavior. -->
<input type="checkbox" class="sidebar-checkbox" id="sidebar-checkbox" checked>

<!-- Toggleable sidebar -->
<div class="sidebar" id="sidebar">
  <div class="sidebar-item">
    <p>R packages with TCGA data Maintainer:<a href="https://github.com/MarcinKosinski">@MarcinKosinski</a></p>
  </div>

  <nav class="sidebar-nav">
    <a class="sidebar-nav-item" href="/RTCGA">Home</a>
		<a class="sidebar-nav-item" href="http://r-addict.com/2016/05/04/RTCGA-Quick-Guide.html">Quick Guide</a>
    

      
      
        
          
        
      
        
          
            <a class="sidebar-nav-item" href="/RTCGA/Applications.html">Web Applications</a>
          
        
      
        
          
            <a class="sidebar-nav-item" href="/RTCGA/Download.html">TCGA Data Download</a>
          
        
      
        
      
        
          
            <a class="sidebar-nav-item active" href="/RTCGA/Usecases.html">Usecases</a>
          
        
      
        
          
            <a class="sidebar-nav-item" href="/RTCGA/Visualizations.html">Visualizations</a>
          
        
      
        
      
        
      
      
       <a class="sidebar-nav-item" href="/RTCGA/staticdocs/">Static Docs</a>
      <a class="sidebar-nav-item" href="https://github.com/RTCGA/RTCGA">GitHub project</a>
  </nav>

</div>

    <!-- Wrap is the content to shift when toggling the sidebar. We wrap the
         content to avoid any CSS collisions with our real content. -->
    <div class="wrap">
      <div class="masthead">
        <div class="container">
          <h3 class="masthead-title">
            <a href="/" title="Home">RTCGA</a>
            <small></small>
          </h3>
        </div>
      </div>

      <div class="container content">
        <div class="page">
  <h1 class="page-title">Usecases</h1>
  <h1 id="tcga-and-the-curse-of-bigdata">TCGA and The Curse of BigData</h1>

<ul id="markdown-toc">
  <li><a href="#tcga-and-the-curse-of-bigdata" id="markdown-toc-tcga-and-the-curse-of-bigdata">TCGA and The Curse of BigData</a></li>
  <li><a href="#goals" id="markdown-toc-goals">Goals</a></li>
  <li><a href="#reproducible-research-support-archivistgithubmarcinkosinskigithubioarchivistgithub" id="markdown-toc-reproducible-research-support-archivistgithubmarcinkosinskigithubioarchivistgithub">Reproducible Research Support: <a href="marcinkosinski.github.io/archivist.github"><code class="highlighter-rouge">archivist.github</code></a></a></li>
  <li><a href="#download-clinical-datasets" id="markdown-toc-download-clinical-datasets">Download clinical datasets</a></li>
  <li><a href="#prepare-data" id="markdown-toc-prepare-data">Prepare data</a>    <ul>
      <li><a href="#prepare-expression-dataset-with-rnaseq" id="markdown-toc-prepare-expression-dataset-with-rnaseq">Prepare expression dataset with RNAseq</a></li>
      <li><a href="#load-all-clinical-data" id="markdown-toc-load-all-clinical-data">Load all clinical data</a></li>
      <li><a href="#calculate-p-values-for-selected-genes" id="markdown-toc-calculate-p-values-for-selected-genes">Calculate p-values for selected genes</a></li>
    </ul>
  </li>
  <li><a href="#number-of-observations-in-brca--next-releases" id="markdown-toc-number-of-observations-in-brca--next-releases">Number of observations in BRCA / next releases</a></li>
  <li><a href="#p-values-for-selected-genes" id="markdown-toc-p-values-for-selected-genes">p-values for selected genes</a></li>
  <li><a href="#low-p-value-small-group" id="markdown-toc-low-p-value-small-group">Low p-value, small group</a></li>
</ul>

<h1 id="goals">Goals</h1>

<p>Here we are presenting some non-standard analyses of RTCGA data.</p>

<ol>
  <li>
    <p>Starting with BRCA cohort, we check how the number of cases is increasing through consecutive releases.</p>
  </li>
  <li>
    <p>We are checking how p-values for simple log-rank model are changing through consecutive releases</p>
  </li>
  <li>
    <p>We are showing that (due to number of genes) some of them have expression confounded with significant clinical outcomes.</p>
  </li>
</ol>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">library</span><span class="p">(</span><span class="n">RTCGA</span><span class="p">)</span></code></pre></figure>

<h1 id="reproducible-research-support-archivistgithubmarcinkosinskigithubioarchivistgithub">Reproducible Research Support: <a href="marcinkosinski.github.io/archivist.github"><code class="highlighter-rouge">archivist.github</code></a></h1>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">library</span><span class="p">(</span><span class="n">archivist.github</span><span class="p">)</span>
<span class="n">createGitHubRepo</span><span class="p">(</span>
  <span class="n">repo</span> <span class="o">=</span> <span class="s2">"RTCGA_UseCases"</span><span class="p">,</span>
  <span class="n">user</span> <span class="o">=</span> <span class="s2">"MarcinKosinski"</span><span class="p">,</span> 
  <span class="n">github_token</span> <span class="o">=</span> <span class="n">github_token</span><span class="p">,</span>
  <span class="n">password</span> <span class="o">=</span> <span class="n">user.password</span><span class="p">,</span>
 <span class="n">default</span> <span class="o">=</span> <span class="n">TRUE</span>
<span class="p">)</span></code></pre></figure>

<figure class="highlight"><pre><code class="language-text" data-lang="text">[1] "MarcinKosinski"</code></pre></figure>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="c1"># every object of class ggplot will be archived
# during print
</span><span class="n">library</span><span class="p">(</span><span class="n">ggplot2</span><span class="p">)</span>
<span class="n">addHooksToPrint</span><span class="p">(</span><span class="n">class</span><span class="o">=</span><span class="n">c</span><span class="p">(</span><span class="s2">"ggplot"</span><span class="p">,</span> <span class="s2">"ggsurvplot"</span><span class="p">))</span></code></pre></figure>

<h1 id="download-clinical-datasets">Download clinical datasets</h1>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">releaseDates</span> <span class="o">&lt;-</span> <span class="n">checkTCGA</span><span class="p">(</span><span class="s2">"Dates"</span><span class="p">)</span>
<span class="n">dir.create</span><span class="p">(</span><span class="s1">'UseCases'</span><span class="p">)</span></code></pre></figure>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="k">for</span><span class="p">(</span><span class="n">i</span> <span class="k">in</span> <span class="n">releaseDates</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">try</span><span class="p">({</span>
    <span class="n">downloadTCGA</span><span class="p">(</span>
      <span class="s2">"BRCA"</span><span class="p">,</span>
      <span class="n">dataSet</span> <span class="o">=</span> <span class="s2">"Merge_Clinical.Level_1"</span><span class="p">,</span>
      <span class="n">date</span> <span class="o">=</span> <span class="n">i</span><span class="p">,</span>
      <span class="n">destDir</span> <span class="o">=</span> <span class="s2">"UseCases"</span>
      <span class="p">)</span> 
    <span class="n">cat</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="s2">"\n"</span><span class="p">)</span>
  <span class="p">},</span> <span class="n">silent</span> <span class="o">=</span> <span class="n">TRUE</span><span class="p">)</span>
<span class="p">}</span></code></pre></figure>

<h1 id="prepare-data">Prepare data</h1>

<h2 id="prepare-expression-dataset-with-rnaseq">Prepare expression dataset with RNAseq</h2>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">library</span><span class="p">(</span><span class="n">RTCGA.rnaseq</span><span class="p">)</span>
<span class="n">library</span><span class="p">(</span><span class="n">dplyr</span><span class="p">)</span>
<span class="n">BRCA.rnaseq.fil</span> <span class="o">&lt;-</span> <span class="n">BRCA.rnaseq</span> <span class="o">%&gt;%</span>
  <span class="n">filter</span><span class="p">(</span><span class="n">substr</span><span class="p">(</span><span class="n">bcr_patient_barcode</span><span class="p">,</span> <span class="m">14</span><span class="p">,</span> <span class="m">15</span><span class="p">)</span> <span class="o">==</span> <span class="s2">"01"</span><span class="p">)</span> <span class="o">%&gt;%</span>
  <span class="n">mutate</span><span class="p">(</span><span class="n">bcr_patient_barcode</span> <span class="o">=</span> 
  <span class="n">substr</span><span class="p">(</span><span class="n">bcr_patient_barcode</span><span class="p">,</span> <span class="m">1</span><span class="p">,</span> <span class="m">12</span><span class="p">))</span></code></pre></figure>

<h2 id="load-all-clinical-data">Load all clinical data</h2>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">files</span> <span class="o">&lt;-</span> <span class="n">list.files</span><span class="p">(</span>
  <span class="n">path</span> <span class="o">=</span> <span class="s2">"UseCases"</span><span class="p">,</span>
  <span class="n">pattern</span><span class="o">=</span><span class="s2">"BRCA.clin.mer"</span><span class="p">,</span>
  <span class="n">recursive</span> <span class="o">=</span> <span class="n">TRUE</span>
<span class="p">)</span>
<span class="n">files</span> <span class="o">&lt;-</span> <span class="n">file.path</span><span class="p">(</span><span class="s2">"UseCases"</span><span class="p">,</span><span class="n">files</span><span class="p">)</span>

<span class="c1"># Here gather some useful statistics
</span><span class="n">n</span> <span class="o">&lt;-</span> <span class="n">c</span><span class="p">();</span><span class="n">names</span> <span class="o">&lt;-</span> <span class="n">c</span><span class="p">()</span>

<span class="c1"># Collect p-values for these genes
</span><span class="n">selected</span> <span class="o">&lt;-</span> <span class="n">c</span><span class="p">(</span>
<span class="m">23L</span><span class="p">,</span> <span class="m">228L</span><span class="p">,</span> <span class="m">259L</span><span class="p">,</span> <span class="m">309L</span><span class="p">,</span> <span class="m">593L</span><span class="p">,</span> <span class="m">664L</span><span class="p">,</span> <span class="m">665L</span><span class="p">,</span> <span class="m">675L</span><span class="p">,</span> <span class="m">676L</span><span class="p">,</span> <span class="m">717L</span><span class="p">,</span> 
<span class="m">847L</span><span class="p">,</span> <span class="m">904L</span><span class="p">,</span> <span class="m">1148L</span><span class="p">,</span> <span class="m">1287L</span><span class="p">,</span> <span class="m">1306L</span><span class="p">,</span> <span class="m">1369L</span><span class="p">,</span> <span class="m">1429L</span><span class="p">,</span> <span class="m">1602L</span><span class="p">,</span> <span class="m">1718L</span><span class="p">,</span> 
<span class="m">1818L</span><span class="p">,</span> <span class="m">1856L</span><span class="p">,</span> <span class="m">1985L</span><span class="p">,</span> <span class="m">2004L</span><span class="p">,</span> <span class="m">2034L</span><span class="p">,</span> <span class="m">2169L</span><span class="p">,</span> <span class="m">2176L</span><span class="p">,</span> <span class="m">2248L</span><span class="p">,</span> <span class="m">2389L</span><span class="p">,</span> 
<span class="m">2478L</span><span class="p">,</span> <span class="m">2514L</span><span class="p">,</span> <span class="m">2550L</span><span class="p">,</span> <span class="m">2551L</span><span class="p">,</span> <span class="m">2555L</span><span class="p">,</span> <span class="m">2682L</span><span class="p">,</span> <span class="m">2944L</span><span class="p">,</span> <span class="m">3008L</span><span class="p">,</span> <span class="m">3153L</span><span class="p">,</span> 
<span class="m">3189L</span><span class="p">,</span> <span class="m">3411L</span><span class="p">,</span> <span class="m">3640L</span><span class="p">,</span> <span class="m">3803L</span><span class="p">,</span> <span class="m">3817L</span><span class="p">,</span> <span class="m">3857L</span><span class="p">,</span> <span class="m">3960L</span><span class="p">,</span> <span class="m">4139L</span><span class="p">,</span> <span class="m">4157L</span><span class="p">,</span> 
<span class="m">4192L</span><span class="p">,</span> <span class="m">4338L</span><span class="p">,</span> <span class="m">4588L</span><span class="p">,</span> <span class="m">4814L</span><span class="p">,</span> <span class="m">5179L</span><span class="p">,</span> <span class="m">5270L</span><span class="p">,</span> <span class="m">5694L</span><span class="p">,</span> <span class="m">5744L</span><span class="p">,</span> <span class="m">5764L</span><span class="p">,</span> 
<span class="m">6028L</span><span class="p">,</span> <span class="m">6033L</span><span class="p">,</span> <span class="m">6544L</span><span class="p">,</span> <span class="m">6593L</span><span class="p">,</span> <span class="m">6680L</span><span class="p">,</span> <span class="m">6797L</span><span class="p">,</span> <span class="m">6798L</span><span class="p">,</span> <span class="m">6831L</span><span class="p">,</span> <span class="m">6844L</span><span class="p">,</span> 
<span class="m">6847L</span><span class="p">,</span> <span class="m">6855L</span><span class="p">,</span> <span class="m">6878L</span><span class="p">,</span> <span class="m">7009L</span><span class="p">,</span> <span class="m">7067L</span><span class="p">,</span> <span class="m">7082L</span><span class="p">,</span> <span class="m">7261L</span><span class="p">,</span> <span class="m">7299L</span><span class="p">,</span> <span class="m">7430L</span><span class="p">,</span> 
<span class="m">7529L</span><span class="p">,</span> <span class="m">7857L</span><span class="p">,</span> <span class="m">7971L</span><span class="p">,</span> <span class="m">7982L</span><span class="p">,</span> <span class="m">8015L</span><span class="p">,</span> <span class="m">8265L</span><span class="p">,</span> <span class="m">8284L</span><span class="p">,</span> <span class="m">8316L</span><span class="p">,</span> <span class="m">8694L</span><span class="p">,</span> 
<span class="m">8706L</span><span class="p">,</span> <span class="m">8832L</span><span class="p">,</span> <span class="m">9400L</span><span class="p">,</span> <span class="m">9585L</span><span class="p">,</span> <span class="m">9593L</span><span class="p">,</span> <span class="m">9706L</span><span class="p">,</span> <span class="m">9734L</span><span class="p">,</span> <span class="m">9778L</span><span class="p">,</span> <span class="m">9858L</span><span class="p">,</span> 
<span class="m">9872L</span><span class="p">,</span> <span class="m">9879L</span><span class="p">,</span> <span class="m">10206L</span><span class="p">,</span> <span class="m">10235L</span><span class="p">,</span> <span class="m">10295L</span><span class="p">,</span> <span class="m">10511L</span><span class="p">,</span> <span class="m">10634L</span><span class="p">,</span> <span class="m">10938L</span><span class="p">,</span> 
<span class="m">10963L</span><span class="p">,</span> <span class="m">11162L</span><span class="p">,</span> <span class="m">11174L</span><span class="p">,</span> <span class="m">11197L</span><span class="p">,</span> <span class="m">11244L</span><span class="p">,</span> <span class="m">11257L</span><span class="p">,</span> <span class="m">11262L</span><span class="p">,</span> <span class="m">11346L</span><span class="p">,</span> 
<span class="m">11554L</span><span class="p">,</span> <span class="m">11600L</span><span class="p">,</span> <span class="m">11713L</span><span class="p">,</span> <span class="m">11793L</span><span class="p">,</span> <span class="m">11876L</span><span class="p">,</span> <span class="m">11879L</span><span class="p">,</span> <span class="m">11890L</span><span class="p">,</span> <span class="m">11893L</span><span class="p">,</span> 
<span class="m">11915L</span><span class="p">,</span> <span class="m">11916L</span><span class="p">,</span> <span class="m">11917L</span><span class="p">,</span> <span class="m">11947L</span><span class="p">,</span> <span class="m">11968L</span><span class="p">,</span> <span class="m">11971L</span><span class="p">,</span> <span class="m">11979L</span><span class="p">,</span> <span class="m">11994L</span><span class="p">,</span> 
<span class="m">12007L</span><span class="p">,</span> <span class="m">12190L</span><span class="p">,</span> <span class="m">12257L</span><span class="p">,</span> <span class="m">12391L</span><span class="p">,</span> <span class="m">12403L</span><span class="p">,</span> <span class="m">12575L</span><span class="p">,</span> <span class="m">12912L</span><span class="p">,</span> <span class="m">13032L</span><span class="p">,</span> 
<span class="m">13105L</span><span class="p">,</span> <span class="m">13451L</span><span class="p">,</span> <span class="m">13486L</span><span class="p">,</span> <span class="m">13531L</span><span class="p">,</span> <span class="m">13598L</span><span class="p">,</span> <span class="m">13617L</span><span class="p">,</span> <span class="m">13815L</span><span class="p">,</span> <span class="m">14053L</span><span class="p">,</span> 
<span class="m">14129L</span><span class="p">,</span> <span class="m">14211L</span><span class="p">,</span> <span class="m">14289L</span><span class="p">,</span> <span class="m">14291L</span><span class="p">,</span> <span class="m">14313L</span><span class="p">,</span> <span class="m">14389L</span><span class="p">,</span> <span class="m">14423L</span><span class="p">,</span> <span class="m">14544L</span><span class="p">,</span> 
<span class="m">14703L</span><span class="p">,</span> <span class="m">14725L</span><span class="p">,</span> <span class="m">14760L</span><span class="p">,</span> <span class="m">14910L</span><span class="p">,</span> <span class="m">14963L</span><span class="p">,</span> <span class="m">15101L</span><span class="p">,</span> <span class="m">15315L</span><span class="p">,</span> <span class="m">15363L</span><span class="p">,</span> 
<span class="m">15392L</span><span class="p">,</span> <span class="m">15507L</span><span class="p">,</span> <span class="m">15696L</span><span class="p">,</span> <span class="m">15762L</span>
<span class="p">)</span>


<span class="n">read_and_joinTCGA</span> <span class="o">&lt;-</span> <span class="k">function</span><span class="p">(</span><span class="n">file</span><span class="p">){</span>
  <span class="n">readTCGA</span><span class="p">(</span><span class="n">file</span><span class="p">,</span> <span class="n">dataType</span> <span class="o">=</span> <span class="s2">"clinical"</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">clin</span>
  <span class="n">names_clin</span> <span class="o">&lt;-</span> <span class="n">gsub</span><span class="p">(</span><span class="n">x</span> <span class="o">=</span> <span class="n">names</span><span class="p">(</span><span class="n">clin</span><span class="p">),</span><span class="s2">"_"</span><span class="p">,</span> <span class="s2">""</span><span class="p">)</span>

<span class="c1"># there are differences in col.names between releases
</span>  <span class="n">which</span><span class="p">(</span><span class="n">names_clin</span> <span class="o">==</span> 
  <span class="s1">'patient.stageevent.tnmcategories.pathologiccategories.pathologict'</span><span class="p">)</span> <span class="o">-&gt;</span>
    <span class="n">this.col</span>
  
  <span class="n">bcr_patient_barcode</span> <span class="o">&lt;-</span> 
    <span class="n">grep</span><span class="p">(</span><span class="s1">'bcrpatientbarcode'</span><span class="p">,</span>
    <span class="n">names_clin</span><span class="p">)</span>
  
  <span class="n">days_to_death</span> <span class="o">&lt;-</span> 
    <span class="n">which</span><span class="p">(</span><span class="n">names_clin</span> <span class="o">==</span> 
    <span class="s1">'patient.daystodeath'</span><span class="p">)</span>
  
  <span class="n">patient.vital_status</span> <span class="o">&lt;-</span> 
    <span class="n">which</span><span class="p">(</span><span class="n">names_clin</span> <span class="o">==</span> 
    <span class="s1">'patient.vitalstatus'</span><span class="p">)</span>
  
  <span class="n">followup</span> <span class="o">&lt;-</span> 
    <span class="n">which</span><span class="p">(</span><span class="n">names_clin</span> <span class="o">==</span> 
    <span class="s1">'patient.daystolastfollowup'</span><span class="p">)</span>
  
<span class="n">names</span><span class="p">(</span><span class="n">clin</span><span class="p">)[</span><span class="n">this.col</span><span class="p">]</span> <span class="o">&lt;-</span> <span class="s1">'stageevent'</span>
<span class="n">names</span><span class="p">(</span><span class="n">clin</span><span class="p">)[</span><span class="n">patient.vital_status</span><span class="p">]</span> <span class="o">&lt;-</span> <span class="s1">'patient.vital_status'</span>
  
  <span class="n">clin</span> <span class="o">%&gt;%</span>
    <span class="n">filter</span><span class="p">(</span><span class="n">stageevent</span> <span class="o">!=</span> <span class="s2">"tx"</span><span class="p">)</span> <span class="o">%&gt;%</span> 
    <span class="n">mutate</span><span class="p">(</span><span class="n">stageevent</span> <span class="o">=</span> 
     <span class="n">substr</span><span class="p">(</span><span class="n">stageevent</span><span class="p">,</span> <span class="m">1</span><span class="p">,</span> <span class="m">2</span><span class="p">))</span> <span class="o">%&gt;%</span> 
    <span class="n">survivalTCGA</span><span class="p">(</span>
      <span class="n">extract.cols</span> <span class="o">=</span> <span class="s2">"stageevent"</span><span class="p">,</span>
      <span class="n">extract.names</span> <span class="o">=</span> <span class="n">FALSE</span><span class="p">,</span>
      <span class="n">barcode.name</span> <span class="o">=</span> <span class="n">names</span><span class="p">(</span><span class="n">clin</span><span class="p">)[</span><span class="n">bcr_patient_barcode</span><span class="p">],</span>
      <span class="n">event.name</span> <span class="o">=</span> <span class="s1">'patient.vital_status'</span><span class="p">,</span>
      <span class="n">days.to.followup.name</span> <span class="o">=</span>  <span class="n">names</span><span class="p">(</span><span class="n">clin</span><span class="p">)[</span><span class="n">followup</span><span class="p">],</span>
      <span class="n">days.to.death.name</span> <span class="o">=</span> <span class="n">names</span><span class="p">(</span><span class="n">clin</span><span class="p">)[</span><span class="n">days_to_death</span><span class="p">]</span>
      <span class="p">)</span> <span class="o">%&gt;%</span> 
    <span class="n">unique</span> <span class="o">%&gt;%</span> 
    <span class="n">left_join</span><span class="p">(</span>
      <span class="n">BRCA.rnaseq.fil</span><span class="p">,</span>
      <span class="n">by</span> <span class="o">=</span> <span class="s2">"bcr_patient_barcode"</span>
    <span class="p">)</span> 
<span class="p">}</span></code></pre></figure>

<h2 id="calculate-p-values-for-selected-genes">Calculate p-values for selected genes</h2>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">pvalues</span> <span class="o">&lt;-</span> <span class="n">matrix</span><span class="p">(</span><span class="m">0</span><span class="p">,</span> <span class="n">length</span><span class="p">(</span><span class="n">files</span><span class="p">),</span> <span class="n">length</span><span class="p">(</span><span class="n">selected</span><span class="p">))</span> <span class="o">-</span> <span class="m">1</span>
<span class="n">library</span><span class="p">(</span><span class="n">survival</span><span class="p">)</span>
<span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="k">in</span> <span class="n">seq_along</span><span class="p">(</span><span class="n">files</span><span class="p">))</span> <span class="p">{</span>
  <span class="n">try</span><span class="p">({</span>
    <span class="n">all</span> <span class="o">&lt;-</span> <span class="n">read_and_joinTCGA</span><span class="p">(</span><span class="n">files</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
    <span class="k">for</span> <span class="p">(</span><span class="n">j</span> <span class="k">in</span> <span class="n">seq_along</span><span class="p">(</span><span class="n">selected</span><span class="p">))</span> <span class="p">{</span>
      <span class="n">selectedCat</span> <span class="o">&lt;-</span> <span class="n">cut</span><span class="p">(</span><span class="n">all</span><span class="p">[,</span><span class="n">selected</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="m">+4</span><span class="p">],</span>
    <span class="n">c</span><span class="p">(</span><span class="m">-100</span><span class="p">,</span><span class="n">median</span><span class="p">(</span><span class="n">all</span><span class="p">[,</span><span class="n">selected</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="m">+4</span><span class="p">],</span> <span class="n">na.rm</span> <span class="o">=</span> <span class="n">TRUE</span><span class="p">),</span><span class="m">10</span><span class="o">^</span><span class="m">9</span><span class="p">))</span>
      
      <span class="k">if</span> <span class="p">(</span><span class="n">min</span><span class="p">(</span><span class="n">table</span><span class="p">(</span><span class="n">selectedCat</span><span class="p">))</span> <span class="o">&gt;=</span> <span class="m">20</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">ndf</span> <span class="o">&lt;-</span> <span class="n">data.frame</span><span class="p">(</span>
          <span class="n">time</span> <span class="o">=</span> <span class="n">all</span><span class="o">$</span><span class="n">times</span><span class="p">,</span>
          <span class="n">event</span> <span class="o">=</span> <span class="n">all</span><span class="o">$</span><span class="n">patient.vital_status</span> <span class="o">==</span><span class="m">1</span><span class="p">,</span>
          <span class="n">var</span> <span class="o">=</span> <span class="n">selectedCat</span>
        <span class="p">)</span>
        <span class="n">pvalues</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">]</span> <span class="o">&lt;-</span> 
          <span class="n">survdiff</span><span class="p">(</span>
           <span class="n">Surv</span><span class="p">(</span><span class="n">time</span><span class="p">,</span> <span class="n">event</span><span class="p">)</span><span class="o">~</span><span class="n">var</span><span class="p">,</span>
           <span class="n">data</span><span class="o">=</span><span class="n">ndf</span><span class="p">)</span><span class="o">$</span><span class="n">chisq</span>
      <span class="p">}</span>
    <span class="p">}</span>

    <span class="n">n</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&lt;-</span> <span class="n">nrow</span><span class="p">(</span><span class="n">all</span><span class="p">)</span>
    <span class="n">names</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&lt;-</span> <span class="n">files</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
  <span class="p">},</span> <span class="n">silent</span> <span class="o">=</span> <span class="n">TRUE</span><span class="p">)</span>
<span class="p">}</span></code></pre></figure>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">archive</span><span class="p">(</span><span class="n">names</span><span class="p">,</span> <span class="n">alink</span> <span class="o">=</span> <span class="n">TRUE</span><span class="p">)</span></code></pre></figure>

<p><a href="https://raw.githubusercontent.com/MarcinKosinski/RTCGA_UseCases/master/gallery/374e1c871a6bd2158a05d23691165e10.rda"><code class="highlighter-rouge">archivist::aread('MarcinKosinski/RTCGA_UseCases/374e1c871a6bd2158a05d23691165e10')</code></a></p>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">archive</span><span class="p">(</span><span class="n">files</span><span class="p">,</span> <span class="n">alink</span> <span class="o">=</span> <span class="n">TRUE</span><span class="p">)</span></code></pre></figure>

<p><a href="https://raw.githubusercontent.com/MarcinKosinski/RTCGA_UseCases/master/gallery/10079ab0be4f49e499b4feb769498661.rda"><code class="highlighter-rouge">archivist::aread('MarcinKosinski/RTCGA_UseCases/10079ab0be4f49e499b4feb769498661')</code></a></p>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">archive</span><span class="p">(</span><span class="n">pvalues</span><span class="p">,</span> <span class="n">alink</span> <span class="o">=</span> <span class="n">TRUE</span><span class="p">)</span></code></pre></figure>

<p><a href="https://raw.githubusercontent.com/MarcinKosinski/RTCGA_UseCases/master/gallery/fce8d759c55e9c8e22be7f00bbb65474.rda"><code class="highlighter-rouge">archivist::aread('MarcinKosinski/RTCGA_UseCases/fce8d759c55e9c8e22be7f00bbb65474')</code></a></p>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">archive</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">alink</span> <span class="o">=</span> <span class="n">TRUE</span><span class="p">)</span></code></pre></figure>

<p><a href="https://raw.githubusercontent.com/MarcinKosinski/RTCGA_UseCases/master/gallery/2af646398735bf53164391220c6ed6f7.rda"><code class="highlighter-rouge">archivist::aread('MarcinKosinski/RTCGA_UseCases/2af646398735bf53164391220c6ed6f7')</code></a></p>

<h1 id="number-of-observations-in-brca--next-releases">Number of observations in BRCA / next releases</h1>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">library</span><span class="p">(</span><span class="n">lubridate</span><span class="p">)</span>
<span class="n">dates</span> <span class="o">&lt;-</span> <span class="n">substr</span><span class="p">(</span><span class="n">names</span><span class="p">,</span> <span class="m">62</span><span class="p">,</span> <span class="m">69</span><span class="p">)</span>
<span class="n">drd</span> <span class="o">&lt;-</span> <span class="n">na.omit</span><span class="p">(</span><span class="n">data.frame</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">ymd</span><span class="p">(</span><span class="n">dates</span><span class="p">),</span> <span class="n">v</span> <span class="o">=</span> <span class="n">n</span><span class="p">))</span>

<span class="n">ggplot</span><span class="p">(</span><span class="n">drd</span><span class="p">[</span><span class="m">-1</span><span class="p">,],</span> <span class="n">aes</span><span class="p">(</span><span class="n">data</span><span class="p">,</span><span class="n">v</span><span class="p">))</span> <span class="o">+</span> 
  <span class="n">geom_point</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="m">3</span><span class="p">)</span> <span class="o">+</span>
  <span class="n">theme_RTCGA</span><span class="p">()</span> <span class="o">+</span> <span class="n">xlab</span><span class="p">(</span><span class="s2">"Date of the release"</span><span class="p">)</span> <span class="o">+</span> 
  <span class="n">ylab</span><span class="p">(</span><span class="s2">"# of patients"</span><span class="p">)</span> <span class="o">+</span>
  <span class="n">ggtitle</span><span class="p">(</span><span class="s2">"BRCA"</span><span class="p">)</span></code></pre></figure>

<p>Load: <a href="https://raw.githubusercontent.com/MarcinKosinski/RTCGA_UseCases/master/gallery/9713383c4369434449da350e0a08a61a.rda"><code class="highlighter-rouge">archivist::aread('MarcinKosinski/RTCGA_UseCases/9713383c4369434449da350e0a08a61a')</code></a>
<img src="/RTCGA/figure/source/Usecases/unnamed-chunk-11-1.png" alt="plot of chunk unnamed-chunk-11" /></p>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">archive</span><span class="p">(</span><span class="n">drd</span><span class="p">,</span> <span class="n">alink</span> <span class="o">=</span> <span class="n">TRUE</span><span class="p">)</span></code></pre></figure>

<p><a href="https://raw.githubusercontent.com/MarcinKosinski/RTCGA_UseCases/master/gallery/eb3ebcb10010d05f33498efa26686834.rda"><code class="highlighter-rouge">archivist::aread('MarcinKosinski/RTCGA_UseCases/eb3ebcb10010d05f33498efa26686834')</code></a></p>

<h1 id="p-values-for-selected-genes">p-values for selected genes</h1>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">pvalues</span> <span class="o">&lt;-</span> <span class="n">pvalues</span><span class="p">[</span><span class="m">1</span><span class="o">:</span><span class="n">length</span><span class="p">(</span><span class="n">names</span><span class="p">),]</span>
<span class="n">plotPValues</span> <span class="o">&lt;-</span> <span class="k">function</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">drd</span> <span class="o">&lt;-</span> <span class="n">data.frame</span><span class="p">(</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">ymd</span><span class="p">(</span><span class="n">substr</span><span class="p">(</span><span class="n">names</span><span class="p">,</span> <span class="m">62</span><span class="p">,</span> <span class="m">69</span><span class="p">)),</span>
    <span class="n">v</span> <span class="o">=</span> <span class="n">pvalues</span><span class="p">[,</span><span class="n">i</span><span class="p">],</span>
    <span class="n">p</span> <span class="o">=</span> <span class="m">1</span><span class="o">-</span><span class="n">pchisq</span><span class="p">(</span><span class="n">pvalues</span><span class="p">[,</span><span class="n">i</span><span class="p">],</span><span class="m">1</span><span class="p">)</span>
  <span class="p">)</span>
  
  <span class="n">drd</span> <span class="o">&lt;-</span> <span class="n">drd</span><span class="p">[</span><span class="n">drd</span><span class="o">$</span><span class="n">v</span> <span class="o">&gt;</span> <span class="m">0</span><span class="p">,]</span>
  <span class="n">drd</span> <span class="o">&lt;-</span> <span class="n">drd</span><span class="p">[</span><span class="m">-1</span><span class="p">,]</span>
  
  <span class="n">ggplot</span><span class="p">(</span><span class="n">drd</span><span class="p">,</span> <span class="n">aes</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">signif</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="m">2</span><span class="p">)))</span> <span class="o">+</span> 
    <span class="n">geom_point</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="m">3</span><span class="p">)</span> <span class="o">+</span>
    <span class="n">xlab</span><span class="p">(</span><span class="s2">"Date of the release"</span><span class="p">)</span> <span class="o">+</span> 
    <span class="n">ylab</span><span class="p">(</span><span class="s2">"p-value (survival model)\n for data from this release"</span><span class="p">)</span> <span class="o">+</span>
    <span class="n">geom_text</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">drd</span><span class="p">[</span><span class="n">c</span><span class="p">(</span><span class="n">which.max</span><span class="p">(</span><span class="n">drd</span><span class="o">$</span><span class="n">p</span><span class="p">),</span> <span class="n">which.min</span><span class="p">(</span><span class="n">drd</span><span class="o">$</span><span class="n">p</span><span class="p">)),],</span>
    <span class="n">color</span><span class="o">=</span><span class="s2">"red"</span><span class="p">,</span> <span class="n">nudge_y</span> <span class="o">=</span> <span class="m">.025</span><span class="p">)</span> <span class="o">+</span> 
    <span class="n">ggtitle</span><span class="p">(</span><span class="n">paste0</span><span class="p">(</span><span class="s2">"Gene: "</span><span class="p">,</span> <span class="n">colnames</span><span class="p">(</span><span class="n">all</span><span class="p">)[</span><span class="n">selected</span><span class="p">[</span><span class="n">i</span><span class="p">]]))</span> <span class="o">+</span>
    <span class="n">theme_RTCGA</span><span class="p">()</span>
<span class="p">}</span>

<span class="n">plotPValues</span><span class="p">(</span> <span class="m">135</span> <span class="p">)</span></code></pre></figure>

<p>Load: <a href="https://raw.githubusercontent.com/MarcinKosinski/RTCGA_UseCases/master/gallery/f71605df250842d472d4891dee6ac91d.rda"><code class="highlighter-rouge">archivist::aread('MarcinKosinski/RTCGA_UseCases/f71605df250842d472d4891dee6ac91d')</code></a>
<img src="/RTCGA/figure/source/Usecases/unnamed-chunk-13-1.png" alt="plot of chunk unnamed-chunk-13" /></p>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">plotPValues</span><span class="p">(</span> <span class="m">47</span> <span class="p">)</span></code></pre></figure>

<p>Load: <a href="https://raw.githubusercontent.com/MarcinKosinski/RTCGA_UseCases/master/gallery/fb297480eb54c5deec3c838ce05e1134.rda"><code class="highlighter-rouge">archivist::aread('MarcinKosinski/RTCGA_UseCases/fb297480eb54c5deec3c838ce05e1134')</code></a>
<img src="/RTCGA/figure/source/Usecases/unnamed-chunk-13-2.png" alt="plot of chunk unnamed-chunk-13" /></p>

<h1 id="low-p-value-small-group">Low p-value, small group</h1>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">all</span> <span class="o">&lt;-</span> <span class="n">read_and_joinTCGA</span><span class="p">(</span><span class="n">files</span><span class="p">[</span><span class="m">20</span><span class="p">])</span>
<span class="n">j</span> <span class="o">&lt;-</span> <span class="m">15789+4</span>
<span class="c1">#all[,j] &lt;- as.numeric(as.character(all[,j]))
</span>
<span class="n">vv</span> <span class="o">&lt;-</span> <span class="n">cut</span><span class="p">(</span>
  <span class="n">all</span><span class="p">[,</span><span class="n">j</span><span class="p">],</span>
  <span class="n">c</span><span class="p">(</span><span class="m">-100</span><span class="p">,</span><span class="m">0</span><span class="p">,</span><span class="m">100</span><span class="p">),</span>
  <span class="n">labels</span> <span class="o">=</span> <span class="n">c</span><span class="p">(</span><span class="s2">"low expression"</span><span class="p">,</span> <span class="s2">"high expression"</span><span class="p">)</span>
<span class="p">)</span>
<span class="n">ndf</span> <span class="o">&lt;-</span> <span class="n">data.frame</span><span class="p">(</span>
  <span class="n">time</span> <span class="o">=</span> <span class="n">pmax</span><span class="p">(</span><span class="n">all</span><span class="o">$</span><span class="n">times</span><span class="p">,</span> <span class="m">1</span><span class="p">),</span>
  <span class="n">event</span> <span class="o">=</span> <span class="n">all</span><span class="o">$</span><span class="n">patient.vital_status</span> <span class="o">==</span><span class="m">1</span><span class="p">,</span>
  <span class="n">var</span> <span class="o">=</span> <span class="n">vv</span>
<span class="p">)</span>
<span class="n">ndf</span> <span class="o">&lt;-</span> <span class="n">na.omit</span><span class="p">(</span><span class="n">ndf</span><span class="p">)</span>

<span class="n">kmTCGA</span><span class="p">(</span>
  <span class="n">ndf</span><span class="p">,</span>
  <span class="n">times</span> <span class="o">=</span> <span class="s2">"time"</span><span class="p">,</span>
  <span class="n">status</span> <span class="o">=</span> <span class="s2">"event"</span><span class="p">,</span>
  <span class="n">explanatory.names</span> <span class="o">=</span> <span class="s2">"var"</span><span class="p">,</span>
  <span class="n">main</span> <span class="o">=</span> <span class="n">paste</span><span class="p">(</span><span class="s2">"Gene:"</span><span class="p">,</span> <span class="n">colnames</span><span class="p">(</span><span class="n">all</span><span class="p">)[</span><span class="n">j</span><span class="p">])</span>
<span class="p">)</span></code></pre></figure>

<p>Load: <a href="https://raw.githubusercontent.com/MarcinKosinski/RTCGA_UseCases/master/gallery/671f60ff865c0c6ce6d7666c5e9576e7.rda"><code class="highlighter-rouge">archivist::aread('MarcinKosinski/RTCGA_UseCases/671f60ff865c0c6ce6d7666c5e9576e7')</code></a>
<img src="/RTCGA/figure/source/Usecases/unnamed-chunk-14-1.png" alt="plot of chunk unnamed-chunk-14" /></p>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">pushGitHubRepo</span><span class="p">()</span></code></pre></figure>



  
  <div id="fb-root"></div>
<script>(function(d, s, id) {
  var js, fjs = d.getElementsByTagName(s)[0];
  if (d.getElementById(id)) return;
  js = d.createElement(s); js.id = id;
  js.src = "//connect.facebook.net/en_US/sdk.js#xfbml=1&version=v2.5";
  fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'facebook-jssdk'));</script>

<a class="fb-share-button" data-href="https://rtcga.github.io/RTCGA" data-layout="button_count"></a>
  

  
  <a href="https://twitter.com/share" class="twitter-share-button"{count}>Tweet</a>
<script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>
  

  
  <script src="//platform.linkedin.com/in.js" type="text/javascript"> lang: en_US</script>
<script type="IN/Share" data-url="https://rtcga.github.io/RTCGA" data-counter="right"></script>
  
  
  
  <a class="g-plus" data-action="share" data-annotation="none" data-href="https://rtcga.github.io/RTCGA"></a>
  


  
  
<div id="disqus_thread"></div>

<script>(function() {
        var d = document, s = d.createElement('script');
        s.src = '//RTCGA.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>

  
</div>



      </div>
    </div>

    <label for="sidebar-checkbox" class="sidebar-toggle"></label>
      
      <!-- Place this tag in your head or just before your close body tag. -->
  		<!-- google plus shares -->
      <script src="https://apis.google.com/js/platform.js" async defer></script>

  </body>
</html>
